
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Dynamicfiles &#8212; Dotmanager 1.11.1_3 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installed-files" href="installed-file.html" />
    <link rel="prev" title="Encryption" href="encryption.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="dynamicfiles">
<h1>Dynamicfiles<a class="headerlink" href="#dynamicfiles" title="Permalink to this headline">¶</a></h1>
<p>Dynamicfiles are used whenever one or more dotfiles need to be altered
before they are symlinked. Because the original shall not be altered by
Dotmanager, Dotmanager processes the specified dotfiles and stores the
altered version in a subdirectory of <code class="docutils literal notranslate"><span class="pre">data/</span></code>. There are different
types of dynamicfiles, each one using their own subdirectory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data/decrypted</span></code>: dotfiles that were decrypted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data/merged</span></code>: dotfiles that were merged from multiple dotfiles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data/piped</span></code>: dotfiles that were piped into a shell command</p></li>
</ul>
<p>To make use of a dynamicfile you can either use one of the helper
commands like <code class="docutils literal notranslate"><span class="pre">decrypt()</span></code> or <code class="docutils literal notranslate"><span class="pre">merge()</span></code> which will return a
dynamicfile or create an instance of a dynamicfile by yourself for more
advanced usage (see the example at the bottom). Every time you do this,
the dynamicfile will be updated immediately (even if you only do a
dry-run) and the generated result will be written to the corresponding
subdirectory.</p>
<p>Because the generated file that will be linked is now outside of your
repository, the repository is obviously not able to track changes
anymore. Also editing a symlink to this file won’t update the original
dotfile(s) in your repository. To circumvent this disadvantage, Dotmanager
will track changes that you apply to the symlinked generated file and
warns you if you would overwrite those changes when you install a
profile. To do so, Dotmanager appends the md5 hash of the file to its
filename and stores a backup file next to it. That way changes won’t be
lost and Dotmanager can calculate a diff for you if you like.</p>
<div class="section" id="workflow-explained-on-an-example">
<h2>Workflow explained on an example<a class="headerlink" href="#workflow-explained-on-an-example" title="Permalink to this headline">¶</a></h2>
<p>Suppose you have the following profile:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Main</span><span class="p">(</span><span class="n">Profile</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">():</span>
        <span class="n">link</span><span class="p">(</span><span class="n">decrypt</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The first time that you install this profile <code class="docutils literal notranslate"><span class="pre">decrypt()</span></code> will search
for the file “text.txt” in your repository, decrypt it and calculate
it’s hash (in this example bb6a0d9da197de74db91745fb9b433e1). It then
writes the decrypted file to</p>
<ul class="simple">
<li><p>data/decrypted/test.txt#bb6a0d9da197de74db91745fb9b433e1 and</p></li>
<li><p>data/decrypted/test.txt#bb6a0d9da197de74db91745fb9b433e1.bak</p></li>
</ul>
<p>Dotmanager will later link to
“data/decrypted/test.txt#bb6a0d9da197de74db91745fb9b433e1”. Now every
time this profile is updated or removed, Dotmanager will update the dynamic
file - which again creates new files with a new hash if the file content
changed - and checks if the calculated hash differs from the current installed
hash. If so Dotmanager warns you that you could lose changes and helps you to
write back the changes to the original file by giving you the following options:</p>
<ul class="simple">
<li><p><strong>Abort</strong>: Abort the installation/removal process to fix changes manually</p></li>
<li><p><strong>Diff</strong>: Displays a diff of the changes and lets you decide again what
to do</p></li>
<li><p><strong>Ignore</strong>: Ignore the warning. The link will be updated/removed but the
changes to the old dynamicfile will stay.</p></li>
<li><p><strong>Patch</strong>: Write a git diff of the changes to a desired location. In some
cases you can apply it to the original directly with git.</p></li>
<li><p><strong>Undo</strong>: Discards all changes made to the file and proceed with
updating/removing the link.</p></li>
</ul>
</div>
<div class="section" id="creating-an-instance-of-a-dynamicfile-manually">
<h2>Creating an instance of a dynamicfile manually<a class="headerlink" href="#creating-an-instance-of-a-dynamicfile-manually" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotmanager.dynamicfile</span> <span class="kn">import</span> <span class="n">EncryptedFile</span>

<span class="c1"># Create an instance of EncryptedFile with the name &quot;test.txt&quot;</span>
<span class="n">encrypt</span> <span class="o">=</span> <span class="n">EncryptedFile</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">)</span>
<span class="c1"># Add the source files that shall be processed (in this case its only one)</span>
<span class="n">encrypt</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="s2">&quot;~/dotfile_repo/test.txt&quot;</span><span class="p">)</span>
<span class="c1"># Update the dynamicfile to process the source and write the resulting file</span>
<span class="n">encrypt</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
<p>Instead of using the absolute path to the dotfile you could use
<code class="docutils literal notranslate"><span class="pre">self.find()</span></code> of the profile to find the file automatically.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotmanager.dynamicfile</span> <span class="kn">import</span> <span class="n">EncryptedFile</span>

<span class="n">encrypt</span> <span class="o">=</span> <span class="n">EncryptedFile</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">)</span>
<span class="n">encrypt</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">))</span>
<span class="n">encrypt</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Dotmanager</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=RickestRickSanchez&repo=Dotmanager&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Dotmanager Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="commandline-interface.html">Commandline Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="python-syntax.html">Python explained</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="info-module.html">Info module</a></li>
<li class="toctree-l2"><a class="reference internal" href="config-file.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="dotignore.html">.dotignore</a></li>
<li class="toctree-l2"><a class="reference internal" href="encryption.html">Encryption</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Dynamicfiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#workflow-explained-on-an-example">Workflow explained on an example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-instance-of-a-dynamicfile-manually">Creating an instance of a dynamicfile manually</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installed-file.html">Installed-files</a></li>
<li class="toctree-l2"><a class="reference internal" href="example-configuration.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html">Tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">For developers</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Dotmanager Usage</a><ul>
      <li>Previous: <a href="encryption.html" title="previous chapter">Encryption</a></li>
      <li>Next: <a href="installed-file.html" title="next chapter">Installed-files</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Erik Schulz.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/dynamicfiles.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/RickestRickSanchez/Dotmanager" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>